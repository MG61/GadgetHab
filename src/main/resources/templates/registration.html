<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta charset="viewport" content="width=device-">
  <title>Регистрация</title>
  <link rel="stylesheet" href="/css/main.css"/>
  <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css">
  <link rel="stylesheet" href="/css/authorization.css"  />
  <link href="https://fonts.googleapis.com/css?family=Nunito:wght@100;200;300;400;500;600;700;800;900&display=swap"
        rel="stylesheet" type="text/css"/>

</head>
<body>

<section id="header">
  <a href="main.html" style="text-decoration: none; font-size: 24px; font-weight: 600; color: #1a153c">GadgetHab</a>

  <div>
    <ul id="navbar">
      <li><a href="main.html">Главная</a></li>
      <li><a href="shop.html">Магазин</a></li>
      <li><a href="about.html">О компании</a></li>
      <li><a href="contact.html">Контакты</a></li>
      <li id="lg-bag"><a href="cart.html"><i class="far fa-shopping-bag"></i></a></li>
      <a href="#" id="close"><i class="far fa-times"></i></a>
    </ul>
  </div>

  <div id="mobile">
    <a href="cart.html"><i class="far fa-shopping-bag"></i></a>
    <i id="bar" class="fas fa-outdent"></i>
  </div>
</section>

<div class="container">
  <div class="img">
    <img src="/img/login_animate.svg"/>
  </div>
  <div class="login-container">
    <form action="#">
      <h2>Регистрация</h2>
      <div class="input-div one">
        <div class="i">
          <i class="fas fa-user"></i>
        </div>
        <div>
          <input id="email_signup" class="input" type="email" placeholder="Почта">
        </div>
      </div>
      <div class="input-div two">
        <div class="i">
          <i class="fas fa-lock"></i>
        </div>
        <div>
          <input id="password_signup" class="input" type="password" minlength="6" maxlength="30" placeholder="Пароль">
        </div>
      </div>
      <div class="input-div two">
        <div class="i">
          <i class="fas fa-lock"></i>
        </div>
        <div>
          <input id="name_signup" class="input" type="text" minlength="2" maxlength="30" placeholder="Имя">
        </div>
      </div>
      <div class="input-div two">
        <div class="i">
          <i class="fas fa-lock"></i>
        </div>
        <div>
          <input id="number_signup" class="input" type="text" minlength="9" maxlength="30" placeholder="Телефон">
        </div>
      </div>
      <div><a href="authorization.html"><strong>Авторизироваться</strong></a></div>
      <input id="SingUp" type="button" class="btn" value="Зарегистрироваться" />
    </form>
  </div>
</div>

<footer class="section-p1">
  <div class="col">
    <a href="#" class="logo" style="text-decoration: none; font-size: 24px; font-weight: 600; color: #1a153c">GadgetHab</a>
    <h4>Контакты</h4>
    <p><strong>Адрес:</strong> г.Москва ул. Нежинская 7</p>
    <p><strong>Телефон:</strong> +7-977-377-34-22</p>
    <p><strong>График:</strong> 10:00 - 17:00, Пон - Пят</p>
    <div class="follow">
      <h4>Подписывайтесь</h4>
      <div class="icon">
        <a href="https://github.com/MG61">
          <i class="fab fa-github"></i>
        </a>
      </div>
    </div>
  </div>

  <div class="col">
    <h4>Категории</h4>
    <a href="vr.html">Шлемы VR</a>
    <a href="console.html">Консоли</a>
    <a href="headphones.html">Наушники</a>
    <a href="microphone.html">Микрофоны</a>
    <a href="pc.html">Комплектующие</a>
    <a href="smartphones.html">Смартфоны</a>
    <a href="games.html">Приложения и игры</a>
    <a href="laptop.html">Ноутбуки</a>
  </div>

  <div class="col">
    <h4>Мой аккаунт</h4>
    <a href="authorization.html">Авторизоваться</a>
    <a href="cart.html">Корзина</a>
    <a href="contact.html">Помощь</a>
  </div>

  <div class="col install">
    <h4>Установить приложение</h4>
    <p>Скачайте прямо с сайта</p>
    <p>или с</p>
    <div onclick="window.location.href = 'about.html'" class="row">
      <img src="/img/download/google_play.png" style="width: 173px; height: 56px" alt=""/>
    </div>
  </div>

  <div class="copyright">
    <p>© 2023, ABRN</p>
  </div>
</footer>

<script type="module">
  import {initializeApp} from "https://www.gstatic.com/firebasejs/9.21.0/firebase-app.js";
  import {getAuth, createUserWithEmailAndPassword} from "https://www.gstatic.com/firebasejs/9.21.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAaS3xROolYg3L52gzlpGB5sNh767PKeqg",
    authDomain: "mediamarkt-87e16.firebaseapp.com",
    databaseURL: "https://mediamarkt-87e16-default-rtdb.firebaseio.com",
    projectId: "mediamarkt-87e16",
    storageBucket: "mediamarkt-87e16.appspot.com",
    messagingSenderId: "1030181747159",
    appId: "1:1030181747159:web:263fd23d6bfd07b60bf392",
    measurementId: "G-BLP34HE0HP"
  };

  // Инициализация бд
  const app = initializeApp(firebaseConfig);
  import {getDatabase, ref, get, set, child, update, remove}
    from "https://www.gstatic.com/firebasejs/9.21.0/firebase-database.js";

  const database = getDatabase();
  const auth = getAuth();

  function getRandomInt(max) {
    return Math.floor(Math.random() * max);
  }

  var i1 = getRandomInt(9999);
  var i2 = getRandomInt(9999);
  var i3 = getRandomInt(9999);
  var i4 = getRandomInt(9999);
  var forcard = i1 + " " + i2 + " " + i3 + " " + i4;

  var SingUp = document.getElementById("SingUp");

  SingUp.addEventListener('click', (e)=>{
    var email_signup = document.getElementById('email_signup').value;
    var password_signup = document.getElementById('password_signup').value;
    var name = document.getElementById('name_signup').value;
    var phone = document.getElementById('number_signup').value;

    console.log("Клик был")
    createUserWithEmailAndPassword(auth, email_signup, password_signup)
            .then((userCredential) =>{
              const user = userCredential.user;

              set(ref(database, 'Пользователи/' + user.uid),{
                email:email_signup,
                pass:password_signup,
                "level":"Начальный",
                name:name,
                phone:phone,
                card:forcard
              })

            })
            .catch((error) =>{
              const errorCode = error.code;
              const errorMessage = error.message;
              console.log("Событие не прошло")
              alert(errorMessage, errorCode);
            });

    alert('Аккаунт успешно создан!');
    setTimeout(function(){
      window.location.href = 'authorization.html';
    }, 3 * 1000);
  });

</script>
</body>
</html>
